Перем НачалоИнтервала Экспорт, 
	КонецИнтервала Экспорт;
Перем Режим;	
//*******************************************
Процедура ПриОткрытии()
	
	//Режим = Форма.Параметр;
	//
	//тзОбъекты = глмМетаданные.ВыбратьОбъекты(глмМетаданные
	//	.Тип2Ид("Документ"));
	//
	//тзОбъекты.ВыбратьСтроки();
	//Пока тзОбъекты.ПолучитьСтроку() = 1 Цикл
	//	Если глмМетаданные.ЭтоКаталог(тзОбъекты.Ид) = 0 Тогда
	//		Об = глмМетаданные.Ид2Ссылка(тзОбъекты.Ид);
	//		сзВиды.ДобавитьЗначение(Об.Вид());
	//		сзВиды.Пометка(сзВиды.РазмерСписка(), 1);	
	//	КонецЕсли;	
	//КонецЦикла;	
	
	Параметр = Форма.Параметр;
	
	Если ТипЗначения(Параметр) <> 100 Тогда
		СтатусВозврата(0);
		Возврат;
		
	Иначе
		
		Режим = Параметр.Получить("Режим");
       	флИнтервал = Параметр.Получить("флИнтервал");
		НачДата = Параметр.Получить("НачДата");
		КонДата = Параметр.Получить("КонДата");
		НомерДокумента = Параметр.Получить("НомерДокумента");

		тзОбъекты = глмМетаданные.ВыбратьОбъекты(глмМетаданные
			.Тип2Ид("Документ"));
		
		тзОбъекты.ВыбратьСтроки();
		Пока тзОбъекты.ПолучитьСтроку() = 1 Цикл
			Если глмМетаданные.ЭтоКаталог(тзОбъекты.Ид) = 0 Тогда
				Об = глмМетаданные.Ид2Ссылка(тзОбъекты.Ид);
				сзВиды.ДобавитьЗначение(Об.Вид());
				сзВиды.Пометка(сзВиды.РазмерСписка(), 1);	
			КонецЕсли;	
		КонецЦикла;
		
	КонецЕсли;	
	
КонецПроцедуры
//*******************************************
Процедура ВклВсе()
	
	Для Й = 1 По сзВиды.РазмерСписка() Цикл
		
		сзВиды.Пометка(Й, 1);
		
	КонецЦикла;	
	
КонецПроцедуры
//*******************************************
Процедура ОтклВсе()
	
	Для Й = 1 По сзВиды.РазмерСписка() Цикл
		
		сзВиды.Пометка(Й, 0);
		
	КонецЦикла;	

КонецПроцедуры
//*******************************************
Процедура НайтиДокумент()
	
	сзДокументы.УдалитьВсе();
	
	Документы = СоздатьОбъект("Документ");
	
	ТекстЗапроса = "
	|select
	|	j.iddoc as iddoc,
	|	j.iddocdef as iddocdef
	|from
	|	1sjourn as j
	|where (j.docno like """ + СокрЛП(НомерДокумента) + """) " 
	+ ?(флИнтервал = 0, ""," and (dtoc(j.date, 1) between """ 
	+ Формат(НачДата,  "ДГГГГММДД") + """ and """ 
	+ Формат(КонДата,   "ДГГГГММДД") + """)");
	
	Таблица = глмOLEDBQuery
		.ВыполнитьИнструкцию(ТекстЗапроса, 
			"", 1, 0, 0, 0);
    
	МДВ = СоздатьОбъект("MetaDataWork");
		
	Таблица.ВыбратьСтроки();	
	Пока Таблица.ПолучитьСтроку() = 1 Цикл
		
		ТекДок = МДВ.ЗначениеИзСтрокиБД(12, 
			_StrToId(Таблица.iddocdef), 
				Таблица.iddoc);

		Поз = сзВиды.НайтиЗначение(ТекДок.Вид());
		
		Если сзВиды.Пометка(Поз) = 1 Тогда
			сзДокументы.ДобавитьЗначение(ТекДок);
		КонецЕсли;	
		
	КонецЦикла;	
    
	Если сзДокументы.РазмерСписка() > 0 Тогда
		сзДокументы.ТекущаяСтрока(1);
	КонецЕсли;	
	
КонецПроцедуры
//*******************************************
Процедура Выбрать(НомКн = 0)
	
	ПолныйПуть = КаталогИБ() + ?(Режим = 0, 
		//"1Cv7.MD\CalcVar\CalcVar_Number6776", 
		"1Cv7.MD\CalcVar\CalcVar_Number6823",
			"1Cv7.MD\Document\Document_Number6784");
	
	Если НомКн = 0 Тогда
		Поз = сзДокументы.ТекущаяСтрока();
		Если Поз <> 0 Тогда
			ТекДок = сзДокументы.ПолучитьЗначение(Поз);
		Иначе
			Возврат;
		КонецЕсли;	
	Иначе
		ТекДок = "Х";
	КонецЕсли;
	
   	Сервис = СоздатьОбъект("Сервис");
   	сзОкна = Сервис.СписокВсехОткрытыхОкон();
   	
   	Для Й = 1 По сзОкна.РазмерСписка() Цикл
   		КонтФ = сзОкна.ПолучитьЗначение(Й);
   		// операция взятия расширения формы
   		// доступна только для группового контекста
   		Если ТипЗначенияСтр(КонтФ) <> "ГрупповойКонтекст" Тогда
   			Продолжить;
   		КонецЕсли;	
   		//\\
   		РасшФ = СоздатьОбъект("РасширениеФормы");
   		РасшФ.УстановитьФорму(КонтФ.Форма);
   		//Сообщить(РасшФ.ПолныйПуть());
   		Если СокрЛП(РасшФ.ПолныйПуть()) = ПолныйПуть Тогда
   			//Сообщить("Ок");
   			КонтФ.Действие_ВыбратьДокумент(ТекДок);
   			КонтФ.Форма.Обновить();
   			Прервать;
   		КонецЕсли;	
   	КонецЦикла;
   	
	Форма.Закрыть();

Конецпроцедуры
//*******************************************
Процедура ПриИзмененииРазмераОкна(ТипСобытия, Ширина, Высота)
	
	Окна = СоздатьОбъект("Окна");
	Окна.РазмерОкна(Форма, 365, 400);
	Окна.МенюОкна(Форма, 1, 0, 0, 0);
	
КонецПроцедуры
