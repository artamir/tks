//*******************************************
‘ункци€ “ест()
	
	¬озврат """глм‘ильтр"" - подключен";
	
 онец‘ункции	
//*******************************************
ѕроцедура ¬ывести¬¬идеѕеречислени€(	// вывести раздел метаданных в схему фильтра 
	// в виде реквизита с перечислением значений 
	хмлѕарсер, 								// парсер схемы фильтра
	хмл орень, 								// корень схемы...
	–азделћетаданных)						// выгружаемый раздел метаданных конфигурации
	ѕерем хмл уст, хмл”зел;
	
	хмл”зел = хмл орень.appendChild(хмлѕарсер.createElement("xs:element"));
	глм’ћЋ.ƒобавитьјтрибут(хмлѕарсер, хмл”зел, "name", –азделћетаданных);
	
	хмл”зел = хмл”зел.appendChild(хмлѕарсер.createElement("xs:simpleType"));
	
	хмл уст = хмл”зел.appendChild(хмлѕарсер.createElement("xs:restriction"));
	глм’ћЋ.ƒобавитьјтрибут(хмлѕарсер, хмл уст, "base", "xs:string");
	
	ƒл€ й = 1 ѕо глмћетаданные.¬ызовћетода(–азделћетаданных + "()") ÷икл
		
		хмл”зел = хмл уст.appendChild(хмлѕарсер.createElement("xs:enumeration"));
		глм’ћЋ.ƒобавитьјтрибут(хмлѕарсер, хмл”зел, "value", 
			глмћетаданные.¬ызовћетода(–азделћетаданных 
				+ "(" + й + ").»дентификатор"));

	 онец÷икла;
	
 онецѕроцедуры	
//*******************************************
ѕроцедура ¬ывести¬¬идеѕоследовательности(	// вывести раздел метаданных в схему
	// фильтра в виде последовательности реквизитов с указанием типа значени€
	хмлѕарсер, 								// парсер схемы фильтра
	хмл орень, 								// корень схемы...
	–азделћетаданных)						// выгружаемый раздел метаданных конфигурации
	ѕерем хмл уст, хмл”зел;
	
	хмл”зел = хмл орень.appendChild(хмлѕарсер.createElement("xs:element"));
	глм’ћЋ.ƒобавитьјтрибут(хмлѕарсер, хмл”зел, "name", –азделћетаданных);
	
	хмл”зел = хмл”зел.appendChild(хмлѕарсер.createElement("xs:complexType"));
	
	хмл уст = хмл”зел.appendChild(хмлѕарсер.createElement("xs:sequence"));
	
	ƒл€ й = 1 ѕо глмћетаданные.¬ызовћетода(–азделћетаданных + "()") ÷икл
		
		хмл”зел = хмл уст.appendChild(хмлѕарсер.createElement("xs:element"));
		глм’ћЋ.ƒобавитьјтрибут(хмлѕарсер, хмл”зел, "name", 
			глмћетаданные.¬ызовћетода(–азделћетаданных + "(" + й + ").»дентификатор"));
		глм’ћЋ.ƒобавитьјтрибут(хмлѕарсер, хмл”зел, "type", глмћетаданные
			.¬ызовћетода(–азделћетаданных + "(" + й + ").“ип") + ?(глмћетаданные
				.¬ызовћетода(–азделћетаданных + "(" + й + ").¬ид") <> "", ".", "") 
					+ глмћетаданные.¬ызовћетода(–азделћетаданных + "(" + й + ").¬ид"));

	 онец÷икла;
	
 онецѕроцедуры	
//*******************************************
‘ункци€ —хема‘ильтра∆урнала(				// формирует схему фильтра журнала 
	хмлѕарсер, 								// парсер схемы фильтра
	хмлЌабор—хем)               			// набор схем
	ѕерем хмл орень, хмл уст, хмл”зел;
	
	// создание схемы
	≈сли глм’ћЋ.—оздатьЁлементƒокумента(хмлѕарсер, хмлЌабор—хем, хмл орень, 
		"xs:schema", "windows-1251") = 0 “огда
			¬озврат 0;
	 онец≈сли;	
    
	// пространства имен схемы
	глм’ћЋ.ƒобавитьјтрибут(хмлѕарсер, хмл орень, "targetNamespace", "http://my.org/journ");
	глм’ћЋ.ƒобавитьјтрибут(хмлѕарсер, хмл орень, "elementFormDefault", "qualified");
	глм’ћЋ.ƒобавитьјтрибут(хмлѕарсер, хмл орень, "attributeFormDefault", "unqualified");
	глм’ћЋ.ƒобавитьјтрибут(хмлѕарсер, хмл орень, "xmlns:tns", "http://my.org/journ");
	
	// описание типа фильтра
	хмл”зел = хмл орень.appendChild(хмлѕарсер.createElement("xs:complexType"));
	глм’ћЋ.ƒобавитьјтрибут(хмлѕарсер, хмл”зел, "name", "‘ильтр");
	
	хмл”зел = хмл”зел.appendChild(хмлѕарсер.createElement("xs:sequence"));
	
	хмл орень = хмл”зел;
	
	// добавление описани€ разделов метаданных
	¬ывести¬¬идеѕеречислени€(хмлѕарсер, хмл орень, "ѕоследовательность");
	¬ывести¬¬идеѕоследовательности(хмлѕарсер, хмл орень, "√рафаќтбора");
	¬ывести¬¬идеѕеречислени€(хмлѕарсер, хмл орень, "∆урнал");
	¬ывести¬¬идеѕоследовательности(хмлѕарсер, хмл орень, "ќбщий–еквизитƒокумента");
	// виды документов
	¬ывести¬¬идеѕеречислени€(хмлѕарсер, хмл орень, "ƒокумент");

	¬озврат 1;
	
 онец‘ункции	
//*******************************************
ѕроцедура ѕрочитатьѕараметры(				// по схеме фильтра формирует таблицу
	// параметров дл€ выбора и результирующий файл
	хмл уст,								// узел схемы фильтра 
	хмлЌастройка,            			    // узел результирующего файла настройки
	“аблица,                   				// таблица параметров
	стрѕуть = "") Ёкспорт       			// ключ соединени€ таблицы с файлом настройки
	
	ƒл€ й = 0 ѕо хмл уст.childNodes.length - 1 ÷икл
		
		хмл”зел = хмл уст.childNodes(й);
		хмл”зелЌастройки = хмлЌастройка;
		стрЌовѕуть = стрѕуть;

		≈сли хмл”зел.tagName = "xs:element" “огда
			стр»м€ = глм’ћЋ.ѕолучитьјтрибут(хмл”зел, "name");
			хмл”зелЌастройки = хмлЌастройка.appendChild(хмлЌастройка
				.ownerDocument.createElement(стр»м€));
			стрЌовѕуть = стрѕуть + ";" + й;
			
			≈сли хмл”зел.childNodes.length = 0 “огда
				“аблица.Ќова€—трока();
				“аблица.ѕараметр = стр»м€;
				“аблица.ѕуть = стрЌовѕуть;
				“аблица.“ип = глм’ћЋ.ѕолучитьјтрибут(хмл”зел, "type");
				
			»наче≈сли хмл”зел.childNodes(0).tagName = "xs:simpleType" “огда
				“аблица.Ќова€—трока();
				“аблица.ѕараметр = стр»м€;
				“аблица.ѕуть = стрЌовѕуть;
				“аблица.“ип = "ѕоле—о—писком";
				
			 онец≈сли;	
			
		»наче≈сли хмл”зел.tagName = "xs:enumeration" “огда
			стр»м€ = глм’ћЋ.ѕолучитьјтрибут(хмл”зел, "value");
		    
			≈сли “ип«начени€(“аблица.¬арианты) <> 100 “огда
				“аблица.¬арианты = —оздатьќбъект("—писок«начений");
			 онец≈сли;	
			
			“аблица.¬арианты.ƒобавить«начение(стр»м€);
			
		»наче
			
		 онец≈сли;	
		 
		ѕрочитатьѕараметры(хмл”зел, 
			хмл”зелЌастройки, “аблица, стрЌовѕуть);
		
	 онец÷икла;	
	
 онецѕроцедуры	
//*******************************************
ѕроцедура «аписатьѕараметры(				// по заполненной таблице параметров
	// заполн€ет данными отбора результирующий файл настройки 
	хмл‘ильтр, 								// результирующий файл настройки
	тз‘ильтр,                   			// таблица параметров
	“аблица,								// интерфейсный элемент с заполненными значени€ми
	флѕо”молч=0)							// использовать значени€ по умолчанию только
	
	тз‘ильтр.¬ыбрать—троки();
	ѕока тз‘ильтр.ѕолучить—троку() = 1 ÷икл

		стрѕуть = тз‘ильтр.ѕуть;
		тѕуть = —тр«аменить(стрѕуть, ";", –азделитель—трок);
		
		хмл”зелЌастройки = хмл‘ильтр;
		
		ƒл€ й = 1 ѕо —тр оличество—трок(тѕуть) ÷икл

			хмл”зелЌастройки = хмл”зелЌастройки
				.childNodes(—трѕолучить—троку(тѕуть, й));

		 онец÷икла;
		
		“аблица.ѕолучить—трокуѕоЌомеру(тз‘ильтр.Ќомер—троки);
		
		≈сли (флѕо”молч = 0) »Ћ» (“аблица.ѕ = "’") “огда
			
			хмл”зелЌастройки.text = «начение¬—троку¬нутр(“аблица.«начение);	
			
		 онец≈сли;
		
	 онец÷икла;	
	
 онецѕроцедуры	
