Функция глВернутьЦену(Тов,КатегорияЦены,ДатаД) Экспорт Далее 

Функция Тест() Экспорт
	Возврат "Глобальный модуль ""ОбщиеФункции"" успешно подключен";
КонецФункции	

Функция НовыйВремФайл() Экспорт
	
	Возврат КаталогВременныхФайлов() 
		+ "t" + _GetPerformanceCounter() + ".tmp";
	
КонецФункции	

Процедура глВводНового(Конт)  Экспорт
	
	конт.Автор = глПользователь;
	
КонецПроцедуры

Функция глОткрытьФайл(Маска = "") Экспорт  
	Перем ИмяФайла, ИмяКаталога;
   
	Маска_ = "Файлы " + Маска + "|*." + Маска;  
   	
	Если СокрЛП(Маска) = "" Тогда
    	Маска_ = "Все файлы |*.*"  
	КонецЕсли;
   
	Если ФС.ВыбратьФайл(0, ИмяФайла, ИмяКаталога, "Открыть файл", Маска_) = 1 Тогда
    	Возврат ИмяКаталога + ИмяФайла;
   	Иначе
      	Возврат "";
	КонецЕсли;
	  
КонецФункции  

Функция глВыбратьКаталог() Экспорт  
	Перем ИмяКаталога;
   
	Если ФС.ВыбратьКаталог(ИмяКаталога, "Выбрать каталог", 60) = 1 Тогда
    	Возврат ИмяКаталога;
   	Иначе
      	Возврат "";
	КонецЕсли;
	  
КонецФункции

//*************************************
Процедура ЗапросКоличестваВПодборе(Конт,Выб,Атрибут1="",Атрибут2="",текЦена=0,ЗначениеВыб = "") Экспорт   

	Если Выб.ПометкаУдаления()=1 Тогда
		Предупреждение("Нельзя выбирать помеченные на удаление элементы!");
		Возврат;
		
	КонецЕсли;
	
	Кол=1;
	Если ВвестиЧисло(Кол,"Введите количество.",15,2)=1 Тогда 
		
		Если ПустоеЗначение(Атрибут1)=0 Тогда
			Конт.НоваяСтрока();
			Конт.УстановитьАтрибут(Атрибут1,ЗначениеВыб);
			Конт.Количество	= Кол; 
			
			тЦена = текЦена;
			Если ВвестиЧисло(тЦена,"Цена товара.",15,2)=1 Тогда
				Конт.Цена	= тЦена;
				Конт.Сумма	= тЦена*Кол;
			КонецЕсли; 
			
			Если ПустоеЗначение(ЗначениеВыб)=0 Тогда
				Конт.УстановитьАтрибут(Атрибут2,выб);
				
			КонецЕсли; 
			
		Иначе         
			Конт.НоваяСтрока(); 
			Конт.Номенклатура = выб;
			Конт.Количество = Кол;
			
			Если Конт.Вид()="КорректировкаТоварныхОстатков" Тогда
				Конт.Цена = глВернутьЦену(выб,Конт.Киоск.КатегорияЦен.Получить(Конт.ДатаДок),Конт.ДатаДок);
				Конт.Сумма = Конт.Цена * Кол;
				
			КонецЕсли;
			
		КонецЕсли;
		
	КонецЕсли;
	
КонецПроцедуры
//*************************************
Функция глВернутьЦену(Тов,КатегорияЦены,ДатаД)  Экспорт
	
	 ЦенаЦены = 0;
	 
	 спрЦены = создатьОбъект("Справочник.Цены");
	 спрЦены.ИспользоватьВладельца(Тов);
	 спрЦены.ВыбратьЭлементы();
	 Пока спрЦены.ПолучитьЭлемент()=1 Цикл
		Если спрЦены.Категория = КатегорияЦены тогда
			Возврат спрЦены.Цена.Получить(ДатаД);
			
		КонецЕсли;
	 	
	 КонецЦикла;
	
	 Возврат ЦенаЦены;
	 
КонецФункции         
///////////////////////////////////////////////////////////
//  Вход: строка, символ-разделитель
//  Выход: кол-во значений, список значений в переданной переменной сзЧасти
//
Функция глРазделитьСтроку(сзЧасти,_сСтрока,сСимвол) Экспорт
	Перем Сч;
	Перем сСтрока;
	сСтрока = _сСтрока;
	сзЧасти.УдалитьВсе();
	Пока 1=1 Цикл
		Сч = Найти(сСтрока,сСимвол);
		Если Сч = 0 Тогда
			Если СтрДлина(сСтрока)>0 Тогда
				сзЧасти.ДобавитьЗначение(сСтрока);
			КонецЕсли;
			Прервать;
		КонецЕсли;
		сзЧасти.ДобавитьЗначение(Лев(сСтрока,Сч-1));
		сСтрока = Прав(сСтрока,СтрДлина(сСтрока)-Сч);
	КонецЦикла;
	Возврат сзЧасти.РазмерСписка();
КонецФункции     
//*************************************
Функция глЗаполнитьРеквизит(Конт,ИмяРекв) Экспорт
	Перем ВыбРез;         
	
	Если	ИмяРекв = "ФизЛицо" Тогда
		выбРез = конт.ФизЛицо;
		Если ВвестиЗначение(выбРез,"Выберите физическое лицо","Справочник.ФизЛица")=0 Тогда
			Возврат "";
		КонецЕсли;
		
		Конт.ФизЛицо = выбРез;
		Возврат "";    
		
	КонецЕсли;
	
КонецФункции         
// Выводит в виде строки название документа
Функция глДокументСтр(Докум,Вид = 0) Экспорт
	Перем Стр;
	Перем ВидДок;
	
	Попытка
		ВидДок = Докум.ПредставлениеВида();
		
	Исключение
	    Стр    = "<Документ не выбран>";
	КонецПопытки;
	Возврат Стр;
КонецФункции

///////////////////////////////////////////////////////////
////
Функция ПолучитьФормат(Значение,Секция)  
	Если ТипЗначенияСтр(Значение)     ="Число" Тогда
	    ПечЗначение = Значение;
		Секция = "Строка_Ч";
	ИначеЕсли ТипЗначенияСтр(Значение)="Справочник" Тогда
		Если Значение.ЭтоГруппа()=1 Тогда
			Секция = "Строка_Г";
		Иначе
			Секция = "Строка_С";
		КонецЕсли;
		ПечЗначение = Значение;
	ИначеЕсли ТипЗначенияСтр(Значение)="Документ" Тогда 
		ПечЗначение = глДокументСтр(Значение);
		Секция      = "Строка_С";
	Иначе
		ПечЗначение = Значение;
		Секция      = "Строка_С";
	КонецЕсли;
	Возврат ПечЗначение;
КонецФункции //    
//
//*******************************************
Процедура глПечатьТаблицы(тблРезультат,ПечЗаголовок="",ПечПодЗаголовок="",ВерхнийКолонтитул="",НижнийКолонтитул="") Экспорт
	Перем Тип,Длина,Точность,Заголовок,Ширина,_Формат,Положение;
	Перем Уровень,Секция;
	Таб = СоздатьОбъект("Таблица");
	Таб.ИсходнаяТаблица("Шаблон");
	//  Вывод заголовка
	Таб.ВывестиСекцию("Заголовок");
	//  Вывод шапки
	Таб.ВывестиСекцию("Шапка|Начало");
	Для Кол=1 по тблРезультат.КоличествоКолонок() Цикл
		Значение = тблРезультат.ПолучитьПараметрыКолонки(Кол,Тип,Длина,Точность,Заголовок,Ширина,_Формат,Положение);
		Таб.ПрисоединитьСекцию("Шапка|Колонка_1");
	КонецЦикла;
	Таб.ПрисоединитьСекцию("Шапка|Конец");
	Таб.Опции(0,0,Таб.ВысотаТаблицы(),0);

	//  Вывод табличной части
	тблРезультат.ВыбратьСтроки();
	Пока тблРезультат.ПолучитьСтроку()=1 Цикл
		Стр      = тблРезультат.НомерСтроки;
		Значение = тблРезультат.ПолучитьЗначение(Стр,1);
		ПечЗначение = ПолучитьФормат(Значение,Секция);
		Таб.ВывестиСекцию(Секция+"|Начало");
		Для Кол=1 по тблРезультат.КоличествоКолонок() Цикл
			Значение    = тблРезультат.ПолучитьЗначение(Стр,Кол);
			ПечЗначение = ПолучитьФормат(Значение,Секция);
			Таб.ПрисоединитьСекцию(Секция+"|Колонка_1");
		КонецЦикла;
		Таб.ПрисоединитьСекцию(Секция+"|Конец");
	КонецЦикла;
	Таб.ВывестиСекцию("Подвал|Начало");
	//  Подведем черту
	Для Кол=1 по тблРезультат.КоличествоКолонок() Цикл
		Значение = тблРезультат.ПолучитьПараметрыКолонки(Кол);
		Таб.ПрисоединитьСекцию("Подвал|Колонка_1");
	КонецЦикла;
	Таб.ПрисоединитьСекцию("Подвал|Конец");
	
	Таб.ТолькоПросмотр(1);
	Таб.Показать("Результат","");
КонецПроцедуры
